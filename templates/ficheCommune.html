<!DOCTYPE html>
<html>
   <head>
        <meta charset="utf-8" />
        <title>Commune de {{referenciel.communeName}} | {{configuration.NOM_APPLICATION}} - {{configuration.STRUCTURE}}</title>

        <!-- Jquery -->
        <script type="text/javascript" src="{{url_for('static', filename='lib/jquery-1.12.4.min.js') }}"></script>
        <script type="text/javascript" src="{{url_for('static', filename='lib/jquery-ui.min.js') }}"></script>
        <link rel="stylesheet" href="{{url_for('static', filename='lib/jquery-ui.css') }}" />

         <!-- Font Awesome -->
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">

        <!-- highcharts -->
        <script src="https://code.highcharts.com/highcharts.js"></script>
        <script src="https://code.highcharts.com/modules/exporting.js"></script>
        <script src="https://code.highcharts.com/modules/export-data.js"></script>

        <!-- Leaflet -->
        <link rel="stylesheet" href="{{url_for('static', filename='lib/leaflet/leaflet.css') }}" />
        <script src="{{url_for('static', filename='lib/leaflet/leaflet.js') }}"></script>
        <script src="{{url_for('static', filename='lib/leaflet/leaflet-fullscreen/leafletFullScreen.min.js') }}"></script>
        <link rel="stylesheet" href="{{url_for('static', filename='lib/leaflet/leaflet-fullscreen/leafletFullScreen.css') }}" />
        <script src="{{url_for('static', filename='lib/leaflet/leafletMarkerCluster.js') }}"></script>
        <link rel="stylesheet" href="{{url_for('static', filename='lib/leaflet/leafletMarkerCluster.css') }}" />
		    <link rel="stylesheet" href="{{url_for('static', filename='lib/leaflet/leafletMarkerCluster.Default.css') }}" />

        <!-- DataTable -->
		    <link rel="stylesheet" href="{{url_for('static', filename='lib/datatables/datatables.min.css') }}"/>
        <script type="text/javascript" src="{{url_for('static', filename='lib/datatables/datatables.min.js') }}"></script>

        <!-- Bootstrap -->
        <link rel="stylesheet" href="{{url_for('static', filename='lib/bootstrap/css/bootstrap.min.css') }}"></link>
        <script type="text/javascript" src="{{url_for('static', filename='lib/bootstrap/js/bootstrap.min.js') }}"></script>

       <!-- Atlas -->
        <link rel="shortcut icon" href="{{ url_for('static', filename='custom/images/favicon.ico') }}">
        <link rel="stylesheet" href="{{url_for('static', filename='css/atlas.css') }}"/>
        <link rel="stylesheet" href="{{url_for('static', filename='css/listEspeces.css') }}"/>
        <link rel="stylesheet" href="{{url_for('static', filename='css/icones.css') }}"/>
        <link rel="stylesheet" href="{{url_for('static', filename='custom/custom.css') }}"/>


   </head>
   <body>
    {% include 'templates/navbar.html' %}
		<div id="sideBar">
			{% include 'templates/sideBar.html' %}
		</div>
		<div class="container-fluid" id="page">

            <div class="col-sm-{{ '7' if configuration.AFFICHAGE_CARTE_FICHE_COMMUNE else '12' }}">
                 <div class="panel panel-default" id="parent">
			        <div class="row">
                        <h4><b>Commune de {{referenciel.communeName}}</b></h4>
                    </div>
                </div>

                <!--<div class="panel panel-default" id="stat2">
                   
                    <div id="pie_chart" style="max-width:660px;height:400px"></div>

                </div>-->
                 <div class="panel panel-default" id="taxons">
                         <div class="row" style="text-align:center;padding:15px"">
                               <div class="col-sm-1 col-md-offset-3" > 
                                    <span style="color: ##35526f;font-size:45px" class="fa fa-shield-alt"></span><br><b style="font-size:150%">{{ listTaxons.taxons | selectattr("protected") | list | count }}</b><br> espèces protégées
                                </div>
                               <div class="col-sm-1"> 
                                    <span class="fa fa-exclamation-triangle" style="font-size:45px"></span><br><b style="font-size:150%">{{ listTaxons.taxons | selectattr("threatened") | list | count }}</b> <br>espèces menacées
                                </div>
                                <div class="col-sm-1"> 
                                    <span class="fa fa-binoculars" style="font-size: 45px;"></span><br/><b style="font-size:150%">{{listTaxons.nbObsTotal | pretty}}</b><br/>{{ 'observations' if listTaxons.nbObsTotal > 1 else 'observation' }}
                                 </div>
                                <div class="col-sm-1"> 
                                    <span class="fa fa-paw" style="font-size: 45px;"></span></br><b style="font-size:150%">{{listTaxons.taxons|length | pretty}}</b><br/>{{ 'espèces' if listTaxons.taxons|length > 1 else 'espèce' }}
                                </div>
                                <div class="col-sm-1"> 
                                    <span class="fa fa-user" style="font-size: 45px;"></span></br><b style="font-size:150%">{{observers | length | pretty}}</b><br/>{{ 'observateurs' if observers|length > 1 else 'observateur' }}
                                </div>

                        </div>
                        <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                        {% for d in data | sort(attribute="n_sp",reverse=True) %}
                            {% set rtaxons = d.taxons | sort(attribute="nom_complet_html") | sort(attribute="protected",reverse=True) | sortLR(attribute="code_lr",reverse=True) %}
                          <div class="panel panel-default">
                            <div class="panel-heading" role="tab" style="padding-top:2px; padding-bottom:2px" id="heading{{ d.code_reseau }}">
                              <h4 class="panel-title">
                                <a role="button" {% if d.n_sp > 0 %} data-toggle="collapse"{% endif %} data-parent="#accordion" href="#collapse{{ d.code_reseau }}" aria-expanded="false" aria-controls="collapse{{ d.code_reseau }}">
                                 <b style="font-size:115%">{{ d.taxons | count }} </b> {{ d.nom_reseau }}   </a>
                                    {% if d.n_sp_protected > 0 %}<span class="badge" title="Espèces protégée">
                                            <span style="display:inline-block;color: #fff;"class="fa fa-shield-alt"></span>  {{ d.n_sp_protected }}
                                    </span>{% endif %}
                                    {% if d.n_sp_threatened > 0 %}<span class="badge" title="Espèces menacées">
                                            <span style="display:inline-block;color: #fff;"class="fa fa-exclamation-triangle"></span>  {{ d.n_sp_threatened }}
                                    </span>{% endif %}
                              </h4>
                            </div>
                            <div id="collapse{{ d.code_reseau }}" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
                              <div class="panel-body">
                                    <table class="table table-bordered">
                                         <tr>
                                            <th style='width:40px'>Protegé</th>
                                            <th style='width:115px'>Liste rouge régionale</th> 
                                            <th>Nom vernaculaire</th> 
                                            <th>Nom latin</th>
                                            <th>Première observation</th>
                                            <th>Dernière observation</th>
                                        </tr>
                                         {% for taxon in d.taxons | sort(attribute="nom_complet_html") | sort(attribute="protected",reverse=True) | sortLR(attribute="code_lr",reverse=True) %}
                                        <tr>
                                                <td align='center'>{% if taxon.protected %} <span style="display:inline-block;color: ##35526f;"class="fa fa-shield-alt"></span> {% endif %}</td>
                                               <td align='center'> {% for lr_statut in taxon.code_lr %} {% if not loop.first %}  | {% endif %} <span class="redlist{{lr_statut | replace('*','star')}} redlistBadge"> {{lr_statut}} </span>  {% endfor %} </td>
                                               <td><a href="{{url_for('main.ficheEspece',cd_ref=taxon.cd_ref)}}" >{{ taxon.nom_vern or '-'}}</a></td>
                                                <td><a href="{{url_for('main.ficheEspece',cd_ref=taxon.cd_ref)}}" >{{ taxon.nom_complet_html | safe}} </a> </td>
                                                <td>{{ taxon.first_obs | int }} </td>
                                                <td>{{ taxon.last_obs | int }}</td>
                                        </tr>
                                         {% endfor %}
                
                                    </table>
                              </div>
                            </div> 
                          </div>
                        {% endfor %}
                         
                </div>
            <div class="alert alert-warning" role="alert"> 
                Les informations données ici représentent l'état actuel des connaissances et <strong>ne peuvent être considérées comme exhaustives</strong>.
            </div>
            </div>
            {% if configuration.AFFICHAGE_CARTE_FICHE_COMMUNE %}
            <div class="col-sm-5" id="mapWrapper">
				<div  class="panel panel-default" id="mapContainer">
					<div class="row ">
						<img id ="loadingGif" src="">
						<div class="panel-heading"><strong>
							 <h4 id="titleMap"> Commune de <i>{{referenciel.communeName}}</i></h4> </strong>
						</div>
						<div class="panel-body">
							 <div id="map"> </div>
						</div>
					</div>
				</div>
            </div>
                {% endif %}
        </div>

        {% if configuration.AFFICHAGE_FOOTER %}
            {% include 'static/custom/templates/footer.html' %}
        {% endif %}

        <script type="text/javascript">
            var communesSearch = {{communesSearch|tojson}};
            var configuration = {{configuration|tojson}};
            var observations = {{observations|tojson}};
            var communeGeoJson = {{referenciel.communeGeoJson|tojson}};
            var url_limit_territory = "{{url_for('static', filename='custom/territoire.json') }}";
            //calcul du nb de colonnes pour le fonctionnement de dataTables.js
            var nbColumn = 6;
            {% if configuration.PATRIMONIALITE %} nbColumn = nbColumn+1;{% endif %}
            {% if configuration.PROTECTION %} nbColumn = nbColumn+1;{% endif %}
            {% if configuration.AFFICHAGE_CARTE_FICHE_COMMUNE %} nbColumn = nbColumn+1; {% endif %}
            var noSordedColumns=[nbColumn-2,nbColumn-1]; //var for dataTables js lib
            var defaultSortedColumn=nbColumn-4; //var for dataTables js lib
        </script>
	  	<script src="{{url_for('static', filename='custom/maps-custom.js') }}"></script>
        <script src="{{url_for('static', filename='listeEspeces.js') }}"></script>
		{% if configuration.AFFICHAGE_CARTE_FICHE_COMMUNE %}
            <script src="{{url_for('static', filename='mapGenerator.js') }}"></script>
            <script src="{{url_for('static', filename='mapCommune.js') }}"></script>
        {% endif %}
        <script src="{{url_for('static', filename='main.js') }}"></script>
        <script type="text/javascript" src="{{url_for('static', filename='chart_taxo.js') }}"></script>
   </body>
</html>

